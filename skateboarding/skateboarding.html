<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>skateboarding</title>
    </head>
    <body>

<canvas id="a">
<script>
let CANVAS_WIDTH=300;
let CANVAS_HEIGHT=300;
let ctx,canvas;


let SK8_OFFSET_FROM_LEFT;
let SK8_WIDTH;
let SK8_FROM_CENTER_TO_WHEEL;
let SK8_HEIGHT;

let CONCRETE_HEIGHT;

let DRAIN_WIDTH;

let height;
let angle;
let speedPiece;
let drain;
let speed;
let jump;

let scene='start';







drawCircle=(x,y,r)=>{ctx.beginPath();ctx.arc(x,y,r,0,2*Math.PI,1);ctx.fill()};

setColor=color=>{ctx.fillStyle=color};

doFiasko=()=>{clearInterval(mainInterval);setTimeout(initialization,3000)};

drainManagement=()=>{//draw and move drains
    setColor`#111`;
    for(j=0;j<drain.length;j++){
        drain[j]-=speed;

        if(drain[j]-DRAIN_WIDTH/2<canvas.width && drain[j]>-DRAIN_WIDTH/2){

            ctx.fillRect(drain[j]-DRAIN_WIDTH/2,canvas.height-CONCRETE_HEIGHT,DRAIN_WIDTH,18);

            if( (drain[j]<(SK8_OFFSET_FROM_LEFT+SK8_WIDTH/2+SK8_FROM_CENTER_TO_WHEEL+DRAIN_WIDTH/2)) && (drain[j]>(SK8_OFFSET_FROM_LEFT+SK8_WIDTH/2-SK8_FROM_CENTER_TO_WHEEL-DRAIN_WIDTH/2)) && jump==0 ){
                doFiasko();
            }
        }
    }
};


drawSpeedThingies=()=>{     //draw grey rects that create illusion of speed
    setColor`#666`;
    for(j=0;j<speedPiece.length;j++){
        if(speedPiece[j]<30)speedPiece[j]=canvas.width;

        speedPiece[j]-=speed;

        ctx.fillRect(speedPiece[j],canvas.height-CONCRETE_HEIGHT/2,30,4)
    }
};


drawSkateboard=(a,h)=>{
    ctx.translate(SK8_OFFSET_FROM_LEFT+SK8_WIDTH/2,canvas.height-h);//drawing skateboard
    ctx.rotate(a);

    setColor`#FFF`;drawCircle(-SK8_FROM_CENTER_TO_WHEEL,15,10);
    setColor`#CCC`;drawCircle(-SK8_FROM_CENTER_TO_WHEEL,15,3);

    setColor`#FFF`;drawCircle(SK8_FROM_CENTER_TO_WHEEL,15,10);
    setColor`#CCC`;drawCircle(SK8_FROM_CENTER_TO_WHEEL,15,3);

    setColor`#000`;ctx.fillRect(-SK8_WIDTH/2,-5,SK8_WIDTH,10);
    setColor`#642`;ctx.fillRect(-SK8_WIDTH/2,0,SK8_WIDTH,5);

    ctx.rotate(-a);
    ctx.translate(-(SK8_OFFSET_FROM_LEFT+SK8_WIDTH/2),h-canvas.height);
};






onload=start=()=>{
    canvas=document.querySelector('#a');
    canvas.height=CANVAS_HEIGHT;
    canvas.width=CANVAS_WIDTH;

    ctx=canvas.getContext`2d`;

    SK8_OFFSET_FROM_LEFT=40;
    SK8_WIDTH=160;
    SK8_FROM_CENTER_TO_WHEEL=50;
    SK8_HEIGHT=25;

    CONCRETE_HEIGHT=20;

    height=SK8_HEIGHT+CONCRETE_HEIGHT;
    angle=0;

    setColor`#999`;ctx.fillRect(0,canvas.height-CONCRETE_HEIGHT,canvas.width,CONCRETE_HEIGHT);//draw concrete
    setColor`#333`;ctx.fillRect(0,0,canvas.width,canvas.height-CONCRETE_HEIGHT);//draw wall

    drawSkateboard(angle,height);


};


initialization=()=>{
    canvas=document.querySelector('#a');
    canvas.height=CANVAS_HEIGHT;
    canvas.width=CANVAS_WIDTH;

    ctx=canvas.getContext`2d`;


    SK8_OFFSET_FROM_LEFT=40;
    SK8_WIDTH=160;
    SK8_FROM_CENTER_TO_WHEEL=50;
    SK8_HEIGHT=25;

    CONCRETE_HEIGHT=20;

    DRAIN_WIDTH=90;

    height=SK8_HEIGHT+CONCRETE_HEIGHT;
    angle=0;
    speedPiece=[10,150,290];
    drain=[1000];
    speed=5;
    jump=0;

    scene='game';

    mainInterval=setInterval( ()=>{//main loop

        setColor`#999`;ctx.fillRect(0,canvas.height-CONCRETE_HEIGHT,canvas.width,CONCRETE_HEIGHT);//draw concrete
        setColor`#333`;ctx.fillRect(0,0,canvas.width,canvas.height-CONCRETE_HEIGHT);//draw wall

        drawSpeedThingies();

        drainManagement();

        drawSkateboard(angle,height);

    },17);
};

ontouchstart=evt=>{
    evt.preventDefault();
    processInteraction(evt)
};

onclick=evt=>{
    evt.preventDefault();
    processInteraction(evt)
};

onkeydown=evt=>{
    //evt.preventDefault();       FIX ME
    processInteraction(evt)
};

processInteraction=evt=>{
    if(scene=='game'){

        if(jump==0){
            jumpInterval=setInterval( ()=>{
                jump++;
                if(jump<=80){
                    height+=1.5;angle-=.01
                }

                if(jump>80 && jump<=120){
                    height+=1;angle+=.02
                }

                if(jump>120){
                    height-=4
                }

                if(jump==160){
                    clearInterval(jumpInterval);jump=0
                }

        },5)
    }
    }else if(scene=='start'){
    scene='game';initialization();
    }
};
</script>


</body>
</html>
